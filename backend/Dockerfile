# Start from OpenJDK base image
FROM eclipse-temurin:21-jdk-alpine

# Set working directory inside container
WORKDIR /app

# Copy compiled JAR file
COPY target/s3-File-Hub-0.0.1-SNAPSHOT.jar app.jar

# Expose the application port
EXPOSE 8080

# Application environment variables with placeholder values
ENV SPRING_APPLICATION_NAME="s3-File-Hub"
ENV AWS_REGION="us-east-1"
ENV AWS_S3_BUCKET_NAME="react-s3-files-bucket"
ENV AWS_ACCESS_KEY="REPLACE_WITH_YOUR_ACCESS_KEY"
ENV AWS_SECRET_KEY="REPLACE_WITH_YOUR_SECRET_KEY"
ENV SPRING_SERVLET_MULTIPART_MAX_FILE_SIZE="500MB"
ENV SPRING_SERVLET_MULTIPART_MAX_REQUEST_SIZE="510MB"
ENV JAVA_OPTS="-Xmx1G"
ENV DATASOURCE_URL="jdbc:postgresql://host.docker.internal:5432/s3-File-Hub"
ENV DATASOURCE_USER="postgres"
ENV DATASOURCE_PASSWORD="REPLACE_WITH_DATABASE_PASSWORD"
ENV SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT="org.hibernate.dialect.PostgreSQLDialect"
ENV SPRING_JPA_HIBERNATE_DDL_AUTO="update"
ENV SPRING_JPA_SHOW_SQL="true"
ENV JWT_SECRET="REPLACE_WITH_STRONG_SECRET_MIN_32_CHARACTERS"
ENV JWT_EXPIRATION="86400000"
ENV SPRING_MAIL_HOST="smtp.gmail.com"
ENV SPRING_MAIL_PORT="587"
ENV SPRING_MAIL_USERNAME="REPLACE_WITH_MAIL_USERNAME"
ENV SPRING_MAIL_PASSWORD="REPLACE_WITH_MAIL_APP_PASSWORD"
ENV SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH="true"
ENV SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE="true"

# Run Spring Boot application
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
